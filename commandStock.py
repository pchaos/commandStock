#!/usr/bin/env python
# -*- coding:utf-8 -*-
"""
周K数据
http://data.gtimg.cn/flashdata/hushen/weekly/sz000868.js
日K数据
http://data.gtimg.cn/flashdata/hushen/daily/13/sz000750.js
"""
import requests as rs
import time
from fake_useragent import UserAgent

ua = UserAgent()
ua.chrome

#debug=True
debug=False

division=5 # 每次获取的股票个数

sleeptime=15  # 等待下一次获取时间. 时间间太短，会无响应

user_agent = ["Mozilla/5.0 (Windows NT 10.0; WOW64)", 'Mozilla/5.0 (Windows NT 6.3; WOW64)',
              'Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.11 (KHTML, like Gecko) Chrome/23.0.1271.64 Safari/537.11',
              'Mozilla/5.0 (Windows NT 6.3; WOW64; Trident/7.0; rv:11.0) like Gecko',
              'Mozilla/5.0 (Windows NT 5.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/28.0.1500.95 Safari/537.36',
              'Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; rv:11.0) like Gecko)',
              'Mozilla/5.0 (Windows; U; Windows NT 5.2) Gecko/2008070208 Firefox/3.0.1',
              'Mozilla/5.0 (Windows; U; Windows NT 5.1) Gecko/20070309 Firefox/2.0.0.3',
              'Mozilla/5.0 (Windows; U; Windows NT 5.1) Gecko/20070803 Firefox/1.5.0.12',
              'Opera/9.27 (Windows NT 5.2; U; zh-cn)',
              'Mozilla/5.0 (Macintosh; PPC Mac OS X; U; en) Opera 8.0',
              'Opera/8.0 (Macintosh; PPC Mac OS X; U; en)',
              'Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.12) Gecko/20080219 Firefox/2.0.0.12 Navigator/9.0.0.6',
              'Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Win64; x64; Trident/4.0)',
              'Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Trident/4.0)',
              'Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.1; WOW64; Trident/6.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; InfoPath.2; .NET4.0C; .NET4.0E)',
              'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.1 (KHTML, like Gecko) Maxthon/4.0.6.2000 Chrome/26.0.1410.43 Safari/537.1 ',
              'Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.1; WOW64; Trident/6.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; InfoPath.2; .NET4.0C; .NET4.0E; QQBrowser/7.3.9825.400)',
              'Mozilla/5.0 (Windows NT 6.1; WOW64; rv:21.0) Gecko/20100101 Firefox/21.0 ',
              'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.1 (KHTML, like Gecko) Chrome/21.0.1180.92 Safari/537.1 LBBROWSER',
              'Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.1; WOW64; Trident/6.0; BIDUBrowser 2.x)',
              'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.11 (KHTML, like Gecko) Chrome/20.0.1132.11 TaoBrowser/3.0 Safari/536.11']

class Utility:
    def ToGB(str):
        if(debug): print(str)
        return str.decode('gb2312')

class StockInfo:
    """
     0: 未知
     1: 名字
     2: 代码
     3: 当前价格
     4: 涨跌
     5: 涨跌%
     6: 成交量（手）
     7: 成交额（万）
     8:
     9: 总市值"""

    def GetStockStrByNum(num):
        headers = {'User-Agent': ua.random}
        r= rs.get('http://qt.gtimg.cn/q=s_'+ str(num), headers= headers)
        #return like: v_s_sz000858="51~五 粮 液~000858~18.10~0.01~0.06~94583~17065~~687.07";
        """
http://qt.gtimg.cn/q=sh600888,sz300104,sz300027,sz000919,sz000001,sz000002,sz000003,sz000004,sz000005,sz000006,sz000002,sz000008,sz000009,sz000010,sz000011,sz000013
        
v_sh600888="1~新疆众和~600888~6.70~6.76~6.79~74111~28989~45122~6.69~618~6.68~868~6.67~621~6.66~630~6.65~193~6.70~50~6.71~110~6.72~179~6.73~86~6.74~265~15:00:04/6.70/14/B/9380/34156|14:59:58/6.69/1/S/669/34143|14:59:55/6.69/10/S/6690/34135|14:59:49/6.70/1/B/670/34118|14:59:43/6.70/2/B/1340/34107|14:59:37/6.70/10/B/6700/34093~20171101150556~-0.06~-0.89~6.83~6.68~6.69/74097/50075366~74111~5008~0.89~49.95~~6.83~6.68~2.22~55.85~55.85~1.68~7.44~6.08~0.80";
v_sz300104="51~乐视网~300104~0.00~15.33~0.00~0~0~0~0.00~0~0.00~0~0.00~0~0.00~0~0.00~0~0.00~0~0.00~0~0.00~0~0.00~0~0.00~0~~20171101150136~0.00~0.00~0.00~0.00~0.00/0/0~0~0~0.00~-38.47~S~0.00~0.00~0.00~390.13~611.58~0.00~16.86~13.80~0.00";
v_sz300027="51~华谊兄弟~300027~8.71~8.77~8.77~84652~32264~52388~8.71~1228~8.70~2399~8.69~425~8.68~989~8.67~392~8.72~720~8.73~431~8.74~255~8.75~1717~8.76~206~15:00:04/8.71/838/S/729898/9633|14:57:00/8.72/50/B/43600/9544|14:56:57/8.71/5/S/4355/9542|14:56:55/8.71/55/S/47955/9540|14:56:49/8.71/4/S/3484/9536|14:56:45/8.72/259/B/225848/9533~20171101150136~-0.06~-0.68~8.80~8.70~8.72/83814/73240422~84652~7397~0.44~30.70~~8.80~8.70~1.14~167.23~241.66~2.55~9.65~7.89~0.68";
v_sz000919="51~金陵药业~000919~10.00~10.13~10.13~38185~12530~25656~9.99~363~9.98~693~9.97~324~9.96~247~9.95~249~10.00~839~10.01~649~10.02~384~10.03~360~10.04~128~15:00:03/10.00/752/B/752000/9632|14:56:55/10.01/11/B/11011/9540|14:56:51/10.00/10/S/10000/9537|14:56:45/10.00/5/S/5000/9533|14:56:42/10.01/268/S/268268/9531|14:56:21/10.01/16/S/16016/9517~20171101150136~-0.13~-1.28~10.15~9.97~10.01/37433/37657839~38185~3841~0.76~29.67~~10.15~9.97~1.78~50.30~50.40~1.94~11.14~9.12~0.94";
v_sz000001="51~平安银行~000001~11.40~11.54~11.56~692617~285136~407482~11.40~2517~11.39~2146~11.38~1571~11.37~424~11.36~386~11.41~1094~11.42~2059~11.43~332~11.44~1363~11.45~1990~15:00:03/11.40/2439/S/2780608/9632|14:57:00/11.39/91/S/103735/9544|14:56:57/11.40/26/B/29640/9542|14:56:55/11.39/134/S/152626/9540|14:56:52/11.40/203/S/231420/9538|14:56:48/11.41/246/B/280476/9535~20171101150136~-0.14~-1.21~11.59~11.32~11.39/690178/790100435~692617~79288~0.41~8.50~~11.59~11.32~2.34~1928.65~1957.43~0.99~12.69~10.39~0.75";
v_sz000002="51~万  科Ａ~000002~29.15~28.96~28.96~622931~294997~327934~29.14~4650~29.13~2562~29.12~500~29.11~525~29.10~363~29.15~334~29.16~110~29.17~18~29.18~101~29.19~560~15:00:03/29.15/5529/S/16117035/9632|14:57:00/29.14/98/B/285544/9543|14:56:57/29.13/22/B/64085/9541|14:56:54/29.14/82/B/238874/9539|14:56:51/29.12/74/S/215681/9537|14:56:48/29.12/81/S/236011/9535~20171101150136~0.19~0.66~30.54~28.73~29.14/617402/1832889163~622931~184901~0.64~13.49~~30.54~28.73~6.25~2830.22~3217.93~2.77~31.86~26.06~1.27";
v_sz000003="51~PT金田Ａ~000003~0.00~0.00~0.00~0~0~0~0.00~0~0.00~0~0.00~0~0.00~0~0.00~0~0.00~0~0.00~0~0.00~0~0.00~0~0.00~0~~20171101150136~0.00~0.00~0.00~0.00~0.00/0/0~0~0~0.00~0.00~D~0.00~0.00~0.00~0.00~0.00~0.00~0.00~0.00~0.00";
v_sz000004="51~国农科技~000004~23.68~23.66~23.59~5574~3022~2552~23.68~188~23.65~21~23.64~9~23.63~100~23.61~18~23.70~86~23.71~2~23.72~49~23.73~11~23.74~14~15:00:03/23.68/169/S/400192/9632|14:56:30/23.70/1/S/2370/9523|14:56:16/23.70/5/S/11850/9513|14:55:03/23.71/1/B/2371/9463|14:54:54/23.70/3/S/7110/9457|14:54:36/23.70/5/B/11848/9445~20171101150136~0.02~0.08~23.86~23.35~23.70/5405/12812166~5574~1321~0.67~103.75~~23.86~23.35~2.16~19.65~19.89~17.23~26.03~21.29~0.85";
v_sz000005="51~世纪星源~000005~4.68~4.73~4.73~55028~19783~35245~4.68~2346~4.67~1576~4.66~3433~4.65~3215~4.64~162~4.69~167~4.70~1586~4.71~442~4.72~587~4.73~790~15:00:03/4.68/1140/S/533520/9632|14:57:00/4.69/9/S/4221/9543|14:56:45/4.69/100/S/46900/9533|14:56:36/4.69/1/S/469/9526|14:56:30/4.69/16/S/7504/9522|14:56:09/4.69/26/B/12194/9508~20171101150136~-0.05~-1.06~4.73~4.67~4.69/53888/25315061~55028~2585~0.58~-119.88~~4.73~4.67~1.27~44.52~49.54~3.91~5.20~4.26~1.12";
v_sz000006="51~深振业Ａ~000006~0.00~9.85~0.00~0~0~0~0.00~0~0.00~0~0.00~0~0.00~0~0.00~0~0.00~0~0.00~0~0.00~0~0.00~0~0.00~0~~20171101150136~0.00~0.00~0.00~0.00~0.00/0/0~0~0~0.00~13.25~S~0.00~0.00~0.00~132.50~132.98~0.00~10.84~8.87~0.00";
v_sz000002="51~万  科Ａ~000002~29.15~28.96~28.96~622931~294997~327934~29.14~4650~29.13~2562~29.12~500~29.11~525~29.10~363~29.15~334~29.16~110~29.17~18~29.18~101~29.19~560~15:00:03/29.15/5529/S/16117035/9632|14:57:00/29.14/98/B/285544/9543|14:56:57/29.13/22/B/64085/9541|14:56:54/29.14/82/B/238874/9539|14:56:51/29.12/74/S/215681/9537|14:56:48/29.12/81/S/236011/9535~20171101150136~0.19~0.66~30.54~28.73~29.14/617402/1832889163~622931~184901~0.64~13.49~~30.54~28.73~6.25~2830.22~3217.93~2.77~31.86~26.06~1.27";
v_sz000008="51~神州高铁~000008~9.16~9.18~9.15~81144~26600~54544~9.15~56~9.14~12~9.13~176~9.12~143~9.11~211~9.16~1306~9.17~813~9.18~1267~9.19~2096~9.20~2873~15:00:03/9.16/1848/S/1692768/9632|14:57:00/9.16/1830/B/1675039/9544|14:56:55/9.13/15/S/13715/9540|14:56:52/9.15/185/B/169227/9538|14:56:48/9.14/83/B/75862/9535|14:56:45/9.13/4/S/3652/9533~20171101150136~-0.02~-0.22~9.22~9.09~9.16/79296/72377306~81144~7407~0.41~60.47~~9.22~9.09~1.42~182.16~258.16~4.14~10.10~8.26~0.49";
v_sz000009="51~中国宝安~000009~8.09~8.15~8.16~162215~55666~106549~8.08~2224~8.07~1358~8.06~1309~8.05~1396~8.04~739~8.09~1930~8.10~1198~8.11~480~8.12~1770~8.13~390~15:00:03/8.09/607/S/491063/9632|14:57:00/8.09/13/B/10517/9544|14:56:57/8.09/30/B/24270/9541|14:56:55/8.08/462/S/373296/9540|14:56:51/8.09/75/B/60668/9537|14:56:49/8.09/10/B/8090/9536~20171101150136~-0.06~-0.74~8.18~8.03~8.09/161608/131121623~162215~13161~0.77~85.45~~8.18~8.03~1.84~171.52~173.88~3.74~8.97~7.34~0.87";
v_sz000010="51~美丽生态~000010~6.02~6.03~6.02~289949~138224~151726~6.01~3030~6.00~7311~5.99~833~5.98~1689~5.97~1354~6.02~3192~6.03~1451~6.04~993~6.05~2379~6.06~2113~15:00:03/6.02/11725/S/7058450/9632|14:57:00/6.01/71/S/42701/9543|14:56:57/6.02/366/B/220059/9541|14:56:54/6.02/26/B/15642/9539|14:56:51/6.01/141/S/84843/9537|14:56:48/6.02/869/B/522330/9535~20171101150136~-0.01~-0.17~6.07~5.95~6.01/278224/167716346~289949~17477~5.55~161.20~~6.07~5.95~1.99~31.43~49.36~2.21~6.63~5.43~0.48";
v_sz000011="51~深物业A~000011~19.63~19.34~19.40~89937~47697~42240~19.63~1212~19.62~122~19.61~164~19.60~108~19.59~82~19.64~223~19.65~313~19.66~867~19.67~370~19.68~371~15:00:03/19.63/1431/S/2809053/9632|14:57:00/19.62/57/S/111856/9543|14:56:57/19.63/34/S/66742/9542|14:56:54/19.63/8/S/15705/9539|14:56:51/19.64/132/B/259156/9537|14:56:48/19.64/15/B/29460/9535~20171101150136~0.29~1.50~19.76~19.40~19.62/88506/173253504~89937~17606~5.11~12.47~~19.76~19.40~1.86~34.52~116.99~4.06~21.27~17.41~1.81";
v_sz000013="51~*ST石化Ａ~000013~0.00~0.00~0.00~0~0~0~0.00~0~0.00~0~0.00~0~0.00~0~0.00~0~0.00~0~0.00~0~0.00~0~0.00~0~0.00~0~~20171101150136~0.00~0.00~0.00~0.00~0.00/0/0~0~0~0.00~-0.00~D~0.00~0.00~0.00~0.00~0.00~0.00~0.00~0.00~0.00";        
        """
        if (r.status_code==200):
            return r.text.split(";")
        else:
            return []

    def ParseResultStr(resultstr):
        if(debug): print(resultstr)
        slist=resultstr[14:-3]
        if(debug): print(slist)
        slist=slist.split('~')

        if(debug) : print(slist)

        #print('*******************************')
        print('  股票名称:', slist[1])
        print('  股票代码:', slist[2])

        print('  当前价格:', slist[3])
        print('  涨    跌:', slist[4])
        print('  涨   跌%:', slist[5],'%')
        print('成交量(手):', slist[6])
        print('成交额(万):', slist[7])
        #print('date and time is :', dateandtime)
        print('*******************************')

    def GetStockInfo(num):
        strs=StockInfo.GetStockStrByNum(num)
        for str in strs:
            if (len(str) > 20):
                #strGB=Utility.ToGB(str)
                StockInfo.ParseResultStr(str)


if __name__ == '__main__':
    stocks = ['sh600888','sz300104','sz300027','sz000919','sz000001','sz000002','sz000003','sz000004','sz000005','sz000006', \
              'sz000007','sz000008','sz000009','sz000010','sz000011','sh600888','sz300104','sz300027','sz000919']
    stStr=''
    i=0
    for stock in stocks:
        stStr+=stock + ','
        print(stStr)
        i+=1
        if (i%division==0 or stock == stocks[len(stocks)-1]):
            StockInfo.GetStockInfo(stStr)
            stStr=''
            time.sleep(sleeptime*4)
            

